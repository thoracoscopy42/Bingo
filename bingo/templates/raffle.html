{% extends "base.html" %}
{% load static %}

{% block content %}

<audio id="rerollSound" src="{% static 'bingo/sfx/reroll.mp3' %}" preload="auto"></audio>

<div class="page">
  <div class="hero hero--wide">
    <div class="panel panel--wide panel--inner">

      <div class="panel__top">
        <span class="panel__pill">Losowanie Bingo</span>
      </div>

      <div class="raffle-shell">
        <button class="raffle-nav raffle-nav--left" type="button" aria-label="Poprzedni grid">‹</button>
        <button class="raffle-nav raffle-nav--right" type="button" aria-label="Następny grid">›</button>
      <div class="raffle-gif-wrap" id="catGifWrap" hidden>
        <img class="raffle-gif" src="{% static 'bingo/images/cat-gambling.gif' %}" alt="Cat slot" />
      </div>
        <div class="raffle-stage">
          {% for grid in grids %}
            <div class="raffle-board raffle-board--set" data-grid="{{ forloop.counter0 }}">
              <div class="raffle-grid">
                {% for row in grid %}
                  {% for cell in row %}
                    <div class="raffle-tile">
                      <div class="raffle-text">
                        {% if cell %}{{ cell.text }}{% else %}—{% endif %}
                      </div>
                    </div>
                  {% endfor %}
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <div class="raffle-actions">
        <div class="btn-wrap">
          <button class="btn btn--primary" type="button" id="btnReroll">REROLL</button>
          <div class="btn-badge" id="badgeReroll">{{ rerolls_left|default:3 }}</div>
        </div>

        <div class="btn-wrap">
          <button class="btn btn--secondary" type="button" id="btnShuffle">SHUFFLE</button>
          <div class="btn-badge" id="badgeShuffle">{{ shuffles_left|default:3 }}</div>
        </div>

        <div class="btn-wrap">
          <button class="btn btn--secondary" type="button" id="btnPick">WYBIERAM CIEBIE</button>
          <div class="btn-badge btn-badge--disabled" id="badgePick">;3 UWU</div>
        </div>
      </div>

    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
  <script id="raffle-config" type="application/json">
{
  "endpoints": {
    "shuffle": "{% url 'raffle_shuffle_use' %}",
    "reroll": "{% url 'raffle_reroll_all' %}"
  },
  "gridSize": 4,
  "audio": { "rerollId": "rerollSound" }
}
</script>

  {# jeśli raffle.js korzysta z window.Bingo.getCookie/showToast, runtime musi być pierwszy #}
  <script defer src="{% static 'bingo/js/plugin_runtime.js' %}"></script>
  <script defer src="{% static 'bingo/js/raffle.js' %}"></script>
{% endblock %}
